package main

import (
	"strconv"
	"strings"
)

var m map[int]map[int]map[bool]int

func D12() []int {
	inputs := []string{
		"?#????????????##?? 1,1,10\n?.???.?#???#???.? 3,6,1\n#?????#??. 1,3,2\n.?#????.????.???. 4,4,2\n.?????.??#? 1,2\n??##???..??????? 6,1\n?.?#?#??.?? 1,3\n.???#?#?..?? 4,1,1\n???????#?##?#???#.? 2,3,8\n?.?#?.#??#? 1,4\n?#?...#??.# 2,1,1\n???.#????#.? 1,1,1,1\n?##?????#.#..??.? 3,3,1,1,1\n.#????????????????? 1,4,3,2,2\n?????#????. 1,5\n????????##??????? 2,1,5,2\n?????#?????????.??? 4,5,2,2\n?..?..?#?.???? 1,1,3\n??#???#????#??.?? 1,2,8,1\n???#????..??? 1,2,1,1\n?.?.?.?.???.?.??.?? 1,1\n#??????????? 1,6,2\n##.????.?????#? 2,4,1,1\n?.???.?##???#????.? 1,1,10\n???#???.????????? 1,4,1,7\n???#??###???? 1,2,6\n??.????#?????.?. 1,1,3,3,1\n????#??#??#??##?.?## 12,2,3\n.????????#????#??? 5,2,5\n??.???##??.?? 1,2,4,1\n#.?#?.?????#.??. 1,3,1,1,1\n??.???????..?#?## 1,3,5\n?#..#.???????#????#. 2,1,1,9\n?#?#???.#??. 4,1,1,1\n????????..?#???#?#.# 1,2,1,1,5,1\n?#???.????.??###??#? 3,1,1,1,8\n#?.????##?#. 1,2,3,1\n.?.????????#????##? 9,2\n#?..???.#??#????? 2,2,8\n.?#?#?##?????.?? 11,1\n?????#??????.#?? 3,2,1,1,3\n#.????.#?#????.? 1,2,6\n?#?.???..? 1,2\n#????###????#????? 1,6,1,1,1\n.#?#??##??? 3,3\n??#??#?##??? 2,1,2,1\n.#???????#??.?#???? 2,1,5,1,2\n??????.??? 3,2\n#.#??#?#?????????#?? 1,8,1,1,2,1\n????#??#???###??#.? 1,10,1\n.###????#??#???? 3,6\n?#?#??????.?##?#.?? 8,1,3,1,1\n??.#?..?#?#?.##?#.? 2,5,4\n.????????##??#???? 4,3,4\n.???..?????? 3,1,1\n?.?...??#?#?# 1,1,3,3\n??????#????#???#?. 13,2\n??.??????#?###?# 1,1,1,7\n??#.????.? 3,3\n?.?#.?????? 2,2\n?.#???????????##?? 2,3,7\n???.#?.???? 1,4\n#?.???#??#???#?? 1,4,8\n???##???????#?? 1,6,4\n?##?##..#??# 2,2,1,1\n?????#??????.???#?? 7,3,1,3\n????#???##?????? 1,2,2,1,1\n??.#?????? 2,1\n????.???#.?#???# 3,2,2,2\n#??###???.?? 1,3,1,1\n???..?#??##??#?? 2,1,8\n.?.?#???.??## 5,3\n????..#?.# 1,1,1\n??????.?#?? 5,1\n##??.#..???#????. 2,1,1,8\n?.#?#???#?#?.? 3,5\n?..##???#?#???#?#??. 3,10\n?..???#???? 1,2,1\n????.??.#.?# 1,1,1,1\n??.??.?.?#?#???????? 1,1,1,5,1,1\n?#??.??#???..??.#?#? 3,5,1,3\n?.??????#?????#? 8,3\n?##???#??#?#.?#.. 11,2\n.#??????????#??? 3,7\n##???..???#?..# 3,1,1,3,1\n.?????#?#??#?. 4,5\n?#?.?#?#??.?.???#? 2,6,1,1,3\n???#???.???. 2,3\n#???????.??.?#??.? 2,2,3\n????..?##???? 1,5\n?.???.???? 1,2,1\n??.#????##????#? 1,7,1,1\n?????????##???.???? 9,1,3\n#??#???#????#?#????# 1,1,1,6,1,1\n???????????#?## 1,2,1,7\n??#.????.??#.??# 2,1,1,1,3\n????#.????#??#????# 1,1,1,1,5,1\n.??...?#????##????## 1,7,4\n???????.???. 4,1,1\n?#????????.?? 3,6,1\n??##?#??..?? 5,1\n????????####?? 1,9\n?.??.??##??#????? 1,1,7,1,1\n???#??.??.??????? 2,1,2\n??#????#?.? 5,1,1\n..???.?.??#?. 1,2\n#????????????#?. 2,6,1\n.???????#?????#??#. 1,6,3,1\n??#???.?###??. 5,3\n?????#.#??????#???. 3,2,4,1,2,1\n?.??#???.???##?. 4,5\n?#??????.??.?? 1,4,2,1\n?????##??. 1,4\n#??????.????.?.?#?## 3,1,1,1,1,5\n??????.#??? 1,1,3\n??????????? 2,4\n#??#?.???#?..#?#. 5,1,1,1,1\n##?#???????#???.##? 12,1,3\n##??#?#???????????.? 11,3\n??.?#?.?.?.??? 2,2\n???##???????. 6,1\n####?.???.???????? 5,4\n??##???#.?? 5,1,1\n.#??.????# 1,2,2\n##?#????.??###? 7,6\n????#???##.??????? 1,7,3\n??#?#??#??#???? 4,5\n.???.?????#?#????.. 1,8,3\n?????????? 1,1,2\n???.???#.???#?? 1,1,4,1,1\n???#?##..##?#???? 7,5\n???#?#????#?.????#?# 7,4,1,1,1\n...?????##??##?? 1,10\n##????.??.? 4,2\n?#??##?????.?#??? 5,2,3\n????.?.??.?? 2,2\n??.??.##??????? 1,2,9\n#??#?##.?????#?.?# 1,4,7,2\n.#??#???.??.????# 7,2,5\n.??????#?#???.#.? 2,5,2,1,1\n???#?.?#?#?? 3,4\n?###???????.#????#.# 9,3,2,1\n??.??????????#?#?? 1,1,1,6,1\n.??????.?? 1,1,1\n?????#?.?? 1,2,1\n.??????#.??#. 2,1,1,1\n??###???????#.? 6,4\n.#??.?#??????#????? 3,2,2,5\n.?.?#.????? 1,1\n?#.#?????# 1,7\n?#??#???..??.?.? 8,1\n###?????????#????. 8,7\n???#?#????. 5,1\n??#??##??##???.???? 10,1\n?#?###????.?.??????? 1,6,4,1\n??.##????# 1,7\n.#???#??.##?.??? 1,1,1,3,1\n..????##?## 2,2,2\n??#?#?????.???????? 6,4\n?????#?#?#?#? 2,3,1,2\n???????#?????? 4,1\n##??????#??##..? 4,8\n??.#???..?.#?. 2,1\n?##???.??????.?# 3,1,3,1,1\n???##????#??.?#?? 1,2,1,1,3\n?.???.???????? 1,2,2,1\n????#??#?#??#?#? 3,8\n??.???.???#? 1,2,4\n???##?..?.#?????.#.? 3,3,1\n?.?.???.??#????? 1,3\n???#..????? 2,1,3\n???#??????????? 1,2,1,1,5\n?#?..?###?? 1,4\n?#??????#?.??#.??# 1,1,2,2,3\n?#????????? 1,2,3\n????.#???..### 1,1,4,3\n??#.??#??????##?? 1,1,2,7\n???#?.???# 4,1,1\n.#??##?#.#?#.. 1,5,3\n#?#?#??#?????.#?? 3,6,1,1,1\n.?????#?#.?????. 8,1,3\n?#????#??? 2,4\n..???#?.???#? 1,2,1,1\n???#??##?#? 7,1\n?##?#??#.?#?##? 2,1,1,1,3\n#??.?????#?#??# 1,1,1,1,6\n#?????????????? 1,2,3,2,1\n??????????#??? 2,1,4\n??????#??.?????#??.? 7,6\n????#?#???????????? 3,3,1,1,1,1\n??#???#??? 3,2\n.????..#?? 1,1\n??##?##?.????????. 5,6\n????..???? 2,1,3\n???.???.?? 1,1,1\n??..?..??### 1,1,4\n.?????.??##.. 1,2\n.##.?.#????. 2,1,2\n##??#???##????? 2,7,1\n#?#???#?##?. 1,1,6\n???.??##?????? 1,1,4,1\n.??#.?.??? 3,1,1\n?????..?.?????#??? 1,1,1,7\n..???#????#.???? 9,1\n#?#??..?#????. 1,3,1,1\n?.??##..?????? 4,1,1\n..#??#??????#..##? 1,3,1,1,3\n.?#?.??????????#?? 3,6,1,2\n..##????#???#?. 3,2,3\n?#???.?????..??###? 1,1,2,1,5\n?#?#?????## 3,5\n.?#?#????? 4,2,1\n?#?..##?#??? 3,4,1\n????###????#..# 10,1\n.#?????#??#.? 2,1,1,1\n#???#??????? 2,5,1\n.??????#???#???? 5,3\n.????#???######?. 2,10\n????????#???? 2,7\n???????.#?#??#??? 1,1,7\n?#??.#?.??? 3,2\n?#??????#???#??? 4,1,2,1,1\n??.##?????#? 2,2,1,1\n????????#????????## 3,2,1,2,3\n#..????##?? 1,3\n?#?????##?#?#?#?.?#? 3,5,5,3\n#?###?.???? 1,4,2\n??????.?.???.#? 4,1,1,1,1\n???.??#?#?#???#?? 1,11\n??.??#??#?##??.? 1,6,2,1,1\n#????????#.. 1,8\n?.#???.##?#?.???#?? 1,1,1,2,1,6\n????#??#??#??.? 7,1,1,1\n?.????#?#??? 1,6\n????.???..#?????? 2,7\n???#?#??#?.. 3,4\n.??..?.??.?? 1,1,1,1\n??.#?#?##?#??? 1,6,1,1\n?.???#?#??#??.#??#. 1,5,1,4\n..??#?.?#?????? 4,3,1\n.??#???#.#?#??? 5,4\n??#.#????##.#.???. 1,1,7,1,1,1\n?#????.#???#????.?#? 3,6,2,2\n.???????#?? 1,1,2\n???#.#????? 4,5\n??.????#??.??? 1,4,3\n???..?????##??#????? 1,7,2,1\n????????????? 2,1,2\n?#?????.?.??????? 4,2,4\n???#??#?##????.?..? 10,1,1,1\n????????#????????. 4,1,2,5\n??##???.??# 6,1,1\n.?.?#????????. 4,1\n#?.??????## 1,2,2\n?.#?..##???##??? 1,2,2,3\n????.##??#???#? 1,1,2,2,1\n????#??..#.? 3,1,1,1\n??.??#??#? 1,4,2\n???.??????..?.?? 2,2,1\n?????????##?.?#.? 1,1,4,1,1\n#?.?#?..#?#??? 1,2,3,1\n?.????.????????? 2,6\n?????#??.. 1,2,1\n???????#????? 2,7\n#??#?????.? 7,1\n???.?.?.?##?????. 1,8\n#?.????#?.# 1,5,1\n??#?#??#??? 4,4\n?#????#?????#? 4,1,3\n.?..??.?#? 1,1,1\n???????????#??.?#? 2,1,2,2,2\n?.????.##?.?##? 1,1,3,2\n???.?????#??#?#? 2,3,1,5\n.?##????.?##? 5,1,3\n#????????? 4,1\n?????....?#???????. 5,2,6\n.?#????#?? 3,1,1\n.#?#.?.#?????#?? 3,1,1,2,1\n?#?#.??????.??#??#?# 1,1,6,1,2,1\n?#??...??????#??##?? 4,13\n?#.???.???#???? 1,2,1,2,1\n????##??????.# 6,4,1\n????????????.??? 4,4\n?.#????????#??.??#? 11,2\n??.?.#??.#?#? 2,1,1,2\n.??????????.? 2,3,1\n.????####?#???????# 11,2\n??#?.?????? 2,1,1\n????#?.?.?.#???#.. 1,5\n?#??.???#??#??.???## 1,1,1,6,4\n??#???????..?..? 2,3,1,1,1\n??##?.?????...# 3,1,1,1\n?.?.?.##????? 1,1,4,1\n????#????#??? 4,6\n?????.???? 4,1,1\n?#??###??#????.????? 13,5\n?????????#?????? 10,3\n??.???????..?#?. 4,1\n.??????..??##.?? 5,4\n#????.??#?##???????? 1,2,9,1\n#???##?##?#?#???# 11,2,1\n???#??##??#????#?? 1,1,7,5\n?#???????#?#????##. 2,14\n?#?#???#.?#??.? 7,3,1\n.?###.?#?.????.#? 4,2,3,2\n?.#.#??#?#?#?###???? 1,1,1,2,9\n?###??????#? 3,1,2,1\n#???#????#????? 1,2,1,2,2\n???#?????#?#???????? 2,1,1,5,1,4\n?????????#. 2,2,1\n?#???#???????#?????? 2,1,1,1,9\n#?##.?????????##?? 4,1,8\n?????#???.??#?????. 4,2\n??????.##.#??## 1,3,2,1,3\n?????..????.. 3,4\n?.?##?#???.#????#??? 2,4,1,2,4\n?.??#????#??#. 4,2,1\n?.????#?#??#??# 1,2,1,1,5\n?#.??.?#?#????.?? 1,7,1\n?#??.?????# 2,2,2\n#?##??#?#.?.??????#? 9,1,2,1,1\n??.???#???#.#????? 1,8,2,1\n?????????##??????? 1,1,9,2\n???#?.??#?????.## 1,2,8,2\n.?##????#?#?#?# 3,1,4,1,1\n?#?##???????#? 6,5\n??????##?????? 1,1,3,1\n.??#.??.#?#??#??? 1,1,1,1,4\n?????#???#.??#? 7,1,2\n?#???..#??#?##??? 4,9\n.#.#?.?#?#.?? 1,1,4,1\n#?###???#? 1,7\n.##??????##???.??? 4,6,1,1\n???.???#?#??#?## 2,1,10\n.??????##??#??#?? 7,1,2\n???#??#???.??.???? 5,1,2,1,1,1\n.#?#???????#???#?? 1,7,1,2\n?.??.?????.??#???? 3,6\n?.#.?#???..??.??? 1,1,5,2,1\n###????#????. 8,2\n?#?#????.?#??.#?? 4,1,3,1\n..??.???##? 1,5\n?#?#???..???#?.#??. 2,3,1,2,1,1\n?#????#???? 7,1\n.??#.????#? 3,1,1\n.#...????????? 1,7\n????.?????#??..? 1,3\n????????????#??.? 2,1,1,3,1\n???????#??##?.? 1,1,6\n??.??#??#.#?.# 1,6,2,1\n?????..???##? 1,3,4\n????????.????. 2,2,4\n?.##?.??#???#??? 1,2,10\n????#??.?? 2,2,1\n#.?.?#???.? 1,1,2\n?.#?..?#?#?#?.? 2,2,1,1,1\n?#????#???? 1,2,5\n???????#??#?.?????. 1,6,3,2,1\n????#????#? 2,1,4\n???#?.??#???##??? 3,8\n??#??.?#?##? 2,1,6\n????#.#.??????#???#? 1,1,1,1,9\n.?????????.??.? 1,1,3,1,1\n.?.??..??. 2,1\n?.????.#??????# 2,1,1,1,1\n?????#??#..?##?. 6,4\n?????#?#???.?.#. 2,6,1\n?#??#?#.?????.?????? 6,1,3,5\n.?#???????????# 1,9\n#???#??..???????.? 1,5,4,1,1\n??.??.?????????#??? 1,1,3,6\n??.?#?###.? 1,6,1\n#?????#??#??.????.? 10,1,1,1\n?????.?#??# 1,4\n???.????..?##???#? 1,3,8\n.#.?#???.?.???????? 1,3,1,1,5,1\n#?.???..#?? 2,1,1\n.??#.?????#.?. 1,1,6,1\n????#?..#?##??.??# 2,3,4,3\n?.?#????###??.?? 1,9,1,1\n??.?????.?? 1,1,2\n#..#????#?????????? 1,1,1,9,1\n.??##????#??#.?? 4,3,1\n##??#?.??#???.?#??# 2,2,3,5\n??.??##????#? 1,6,2\n??#?????..??.?.. 6,1,1\n???.?.?????##????. 2,1,2,2,1\n???#????#??#? 4,6\n????#?????..???#?? 5,3,4\n?????????.?? 1,7,1\n.??#?.?????#???? 4,8\n?.????.#??#?? 4,4\n##??##.#????..???. 3,2,1,1,3\n.?.????..????.#? 1,2,1,1,1\n#?????#???? 1,5,1\n.?????.#??##????? 3,8\n#??????#??????????? 3,1,4,3,3\n??#?##...?#.???#??? 1,4,1,1,2,1\n.##?..#.???????##?. 3,1,3,5\n?###???#??????#?.??? 14,2\n????.?????????#??# 1,1,5,2,1\n????????.????.? 1,1,1,1,2\n??.?#???.?#? 1,2,2,3\n???#?#??????#? 1,6,1\n???#????.??????.#? 1,1,1,3,1\n#?##?????? 5,3\n#..????##???. 1,1,3,1\n.????#??#????.# 5,1,1,1,1\n????#?#.??????????? 6,5,3\n.#??????????? 9,1\n??????##?? 1,3,2\n#????#.##?#?#?? 3,1,2,5\n##??#??#?#.#???? 10,1,1\n??##?#.?#??.?##?.##? 5,1,1,3,2\n??.???????..?. 6,1\n?##?.#????#.? 3,2,1,1\n#??#.#?????? 4,1,1,2\n???????.??? 2,1,1\n#???.#.??#?? 1,1,1,2\n.??#?###??. 6,1\n.##?????.?.???#. 4,1,4\n???.?.??##??? 1,1,2,1\n.?#.?.???#??.?#?# 1,3,3\n???????#.?#???? 3,2,2\n?#????.?#?.? 1,1,3\n#??#?.??#?.?# 2,1,2,1\n????????.#????? 2,4\n.??..??..?. 1,1\n.?.#.?.#???.? 1,3\n???##???.?????.? 4,1,1,3\n?#??##?###??????. 9,1\n.???.?.??????? 1,1,4\n.????????#.?.# 6,1,1\n?#?.???##? 2,5\n???????#??#?#??????# 5,2,6,3\n.??.??#??? 1,6\n??#????????? 1,1,3\n?#??????#?#????.??#. 13,1,1\n?????#.?.#??.? 4,2\n#???.??#.?#? 2,1,2,1\n#????#?##??????#.??? 1,1,8,1,1,1\n?#?.????#? 2,1,3\n???.#????####??#. 1,1,1,1,7\n??.?#??????##???? 2,2,10\n?.????#????? 5,1,1\n??##?????##? 5,3\n????#?#?#??.??????? 7,2,3,2\n??#?#.?#.#???? 4,2,3,1\n?#?????#????? 1,1,1,2\n?????????.?#???#??. 3,3,8\n?#????.??#?.?.?.??? 3,3,3\n???##???#?? 1,2,4\n?.???.##?##?..?.?.? 1,1,6,1,1,1\n?#?.?????#? 3,2,2\n???.???#.? 1,1,1\n?????.???.#??.#?.?. 1,1,3,2,1,1\n????.?????#????? 2,9\n??####??#### 4,5\n.??.????.. 1,1,1\n????#????.?... 4,1,1\n??.?#??#.??..???#?. 3,1,5\n??##?#?.???.?. 6,1\n???#??#???#???.?? 4,3\n?#??#?##????.#??#??? 11,1,5\n???#?##???#??.?????? 1,1,6,1,4\n??#?#????.??#????#?? 1,7,1,1,1,1\n#.??#???.???? 1,4,1,1\n?.??#???##??????### 1,1,12\n???#?.?#?..????? 1,1,3,1,2\n?.?#.????# 1,2,2\n?????#??#?? 1,1,3\n#??###.#?? 6,2\n#????.#???? 1,1,3\n????#???#.?????..#. 7,1,1,1,1\n???.??#?????#??.# 1,1,10,1\n?##????#???.???#??? 9,4\n?.????#.??.????. 1,2,1,1,2\n?????.???#??#??? 2,1,1,1,2\n??##??..?????? 4,4\n????#???#?..???#. 1,1,6,2,1\n?.?.???..#???????? 1,1,1,1,2,1\n.????.????.. 4,2\n.??.?.#??.?????? 1,2\n.?.????.#?????#?? 1,1,1,6\n????#?#??????###??#? 1,1,1,1,11\n?#??.??#???#??? 2,1,2,3,1\n?#?..#???..? 2,1,2\n?.???#?????.? 1,1,4,2\n#?#??###.. 3,3\n.???#.??.??? 1,1,1,1\n??#???.##?.??????. 4,3,4\n?..?.#?#?#.??? 1,1,3,1\n?.?...#?.?.?#??? 1,1,2,4\n???.??.?????#.?#?.. 1,1,6,3\n##???????.?????##? 3,1,1,3\n#????#??.??.? 1,4,2,1\n???????#?#?#.?# 1,3,4,1,1\n?????.#?#??#?? 3,6\n?.#??????#..##..??? 1,1,1,4,2,3\n???????#.???????## 5,1,9\n#??.??##?. 3,4\n?..?####????#????#. 1,7,3,1\n????#?...?#?##??#??? 4,10\n??.?#??????#??##? 2,3,6\n#????#??#?##???#??. 1,1,14\n???##??.?????. 6,2,1\n#?????????##?#..# 5,6,1,1\n##???.#???#?#..?#. 5,3,3,1\n?#????.????#?.?# 1,1,1,2,2\n????#?.?#? 6,1\n????#????.?????????? 1,5,1,2,1,1\n.?#..##???#??? 1,2,3\n?#????#???#?.?.????# 6,4,1,5\n??????.#?...?????? 1,2,2,3\n???##?????.??.?? 8,1,1,1\n??#????.???? 6,1\n?.????????#?..??.? 1,1,1,5,1,1\n?????#?#.???#?.?# 2,1,1,4,1\n.#?????????..?? 2,1,1,1,1\n.?.???.???? 1,2\n??????##????.?????#? 1,5,1,1,1,1\n?.????#??#?.?.#? 1,2,4,1,1\n??.?#?#???# 4,1\n???..#?.??#????. 2,1,6\n#?###??.?.??? 6,1,3\n??#??##???. 1,8\n?#???.??.#??? 4,2,2\n????????.?? 7,2\n??.??#?#??#????.#? 1,11,1\n.??????#?####?# 1,1,1,6\n?##???#?????? 4,1,2\n????#?###.. 1,6\n??.#..??????#???#? 2,1,1,5,3\n#???#??.#. 1,4,1\n?#??.#????????##?## 1,14\n.???###?#??#?. 1,8\n#????.##?????? 1,2,3,3\n#?????##??#????##?. 1,2,6,5\n#?#????#?? 5,1,1\n.????#??##???. 2,8\n?#?..????##?? 2,7\n???###????. 5,1,1\n????#?#?#?? 4,4\n?.????.?#??##? 2,2,3\n??.??????#?????# 2,3,4\n?..????#??? 1,6\n?????#???? 4,2\n#??.?.#??.??.#???. 2,1,3,1,1,1\n?#.?#?.#..??.?????? 2,1,1,1,1,3\n#???#?#.??#???# 2,1,1,5,1\n##?????.#.????.. 2,2,1,1,3\n?????.??#????.?#?? 3,1,5,2,1\n????###?????#? 2,5,3\n#???.##.??..#? 1,2,2,1\n.#??#???#.?. 5,1\n???#??#????????.??? 1,2,3,1,2,2\n?.?#????.??##?.? 3,2\n????#?????. 5,1,1\n????????##?.? 3,5\n??????????????#??##? 3,2,7\n??.?..?????? 1,1,4\n#.#???##??#???.????. 1,1,7,1,1,1\n????#????.?.?? 4,3\n???.?#??#??#??##?? 1,1,2,2,2,2\n..???#.??.?? 1,1,1,1\n?.????#????? 2,2,1\n##?#??.#?.. 2,1,2\n??..??#???#?##???? 1,10,1\n????..????###??? 1,3,5\n????##?####??.?#?? 2,8,1,2\n.####???#??.#. 8,1,1\n.???.????????#.?. 2,3\n.?.????????. 1,1,1,1\n?.?#???#??.??? 7,1\n??.###?##???? 1,7\n??#??.??#?#??? 2,1,7\n#?#??##?????#.?.? 3,9\n#.?????##? 1,1,5\n??#?.???#?. 2,1,1\n.#??????.??#????? 4,4\n?.??????.##???# 1,3,1,3,1\n?#?.?#.#?#??##??.? 1,1,9\n?????#.??????#. 1,1,1,1,3\n.#?#???.?? 1,4\n.#??#???..???? 6,3\n??.??.#??#.#???.?? 1,1,4,1,1,1\n?##?#?#?????.### 9,1,3\n?#?#?#??#??#?. 8,2\n?.???..?#??. 1,3\n##?.?????.#????.#? 3,1,3,1,1,2\n.??????.?.? 5,1\n????.#????##?? 1,3\n.?????????#????. 1,1,5,1\n????.?##?????.??#??# 3,5,1,1,2,1\n?.#?#?.???#.? 1,2,1,1\n?.??#??#??#?.??????. 7,3\n??????????????#.? 2,2,4\n?????.??#????#.#? 1,1,1,6,1\n#??#??#???? 2,1,5\n.??#???#?? 2,1,1\n?????.?????????? 1,1,1,6\n??..???#??.#. 2,4,1,1\n???#?????? 1,3\n.??.##??.??#?? 1,2,1,3\n.????##?#?#?????? 1,6,2\n????##?##?????? 4,8\n.??#?#??#?##?????? 1,1,1,11\n?#?#?#???????# 5,1,1\n????????#?? 3,1\n.?????????#. 6,2\n#??#????#.???##??? 4,1,1,1,5\n?.????????. 1,1,1\n?.????#?????#??#? 1,2,1,5\n?????????..#. 1,1,2,1\n?????????#?#.???? 1,1,6,1,1\n.#?##?.??? 5,1\n?.?.#??????#???#?# 1,1,1,1,7\n#?.??????#??##? 1,1,9\n?.??.???.???##?.?? 1,1,1,1,6,2\n#??#??#..# 2,4,1\n##???#???????????. 8,1,2,1\n?#?????.?#???? 4,1\n#?.?????.#?#???????? 1,5,3,1,3\n???#?#.?#.???#???? 6,2,1,3,1\n?.?????.???? 2,1,1,1\n?#???..??? 4,1\n#?.??###?????..? 1,8\n???#?????# 4,1\n??????????#.??#? 10,1,2\n?#?#..##.#??.?? 3,2,2,1\n???????#?##?##?. 2,3,2,3\n???.?..???? 1,1\n?.##?##?#.??##??#?? 7,7\n.??#?????? 5,1\n..?????.?.#?? 4,2\n????.????#??? 2,1,2,1\n.#??#?????????# 1,5,1,2\n???#??.????????#??? 1,1,1,7,1\n.??#????.? 6,1\n???.?..??????? 1,1,3\n????#??????##.??? 13,2\n????#?#??? 3,2\n?.??.???##? 1,3\n#.?????#????##? 1,1,4,1,3\n??#??.??.#???#??.?# 1,2,1,6,1\n.???#?#?.#?? 6,1,1\n??#??#????????. 9,2\n?#??#???#?????#??? 1,6,1,1,2,1\n??#???????##???? 2,10\n???.????????# 1,1,6\n???????#??? 1,4\n?#??#????.? 5,1,1\n??#?.???#??#???.?#?? 3,8,1\n??..?#??????##?? 1,5,3\n.?????#?#????? 3,3,3\n?????#?????#????##? 6,10\n?..??.?#?#?..?? 1,1,5,2\n?#.?#????##??#???? 1,5,8\n?.??????.??# 1,5,1\n..?####?###???###? 8,4\n#??#????#?.#??? 1,8,3\n?##?..?#?????#?. 2,8\n???.??#.???##? 3,3,2\n?.?.??.???????? 1,1,2,5,1\n??#??#????.??#??#?? 5,2,7\n???.?#???#.??#??# 1,2,1,5\n???.?#?.???#???? 3,2,1,3,2\n?.?????#??#? 1,1,1,1\n????????#.? 1,2,1\n??##?????#?.?.? 11,1\n.?????#?.???# 7,1,1\n??.??#????#??.???. 1,1,1,3,1,1\n????##??????..????? 4,2,3\n.#.?.#???? 1,3\n.?#??..???. 4,1,1\n??#????#.?#?#??? 3,2,3,1\n.???.##????#??????? 2,8,1,1\n????????.????..??.? 1,2\n?????#???.?????? 5,1,1,2\n#?#???##??? 1,8\n?.????#??#??? 1,10\n??##????.?.. 8,1\n###?.????.. 3,4\n????.????.??????.??? 2,1\n.??????????#.?? 1,3,2,1\n.???#?#?#??#???.?. 1,12\n?.?#?..???? 1,2,3\n??#..??.????? 1,1,4\n?#??????.? 3,1,1\n?#???#???#???##?##?. 1,3,1,7\n.?.?#..??.???? 1,2,2,4\n??.??????.#.? 1,3,1,1\n?#????.???.?# 3,1,2\n???##???#?##?#??#? 1,15\n.#?#???.???.????? 6,1,5\n.?#???????.?.###???? 9,3,1\n#.?????????###? 1,10\n..????????###??.?#? 7,4,1\n?##?#??#??????? 5,2,1,1\n??#???????#. 1,3\n????????#?.??.?? 2,1,4,2,2\n??#??#??#?????#??? 6,1,1,1,1,1\n.#??????.##? 7,3\n????##??????#??????. 5,3,2,1,1\n.???#?#.?###?#.? 2,1,1,5\n???????.????#. 4,5\n??#?#.?????#???# 4,2,4,2\n?..?????##?? 1,9\n?????.?#??? 3,1,1\n#?.????????#?? 2,5,2,1\n?????###.?.? 1,5,1,1\n????????.#?????.? 1,2,2\n?????????????????# 1,4,2,2,1\n.?????.??????.# 2,1,1,2,1\n?????????##??#####. 1,2,10\n#?#???##??.??? 3,5,1\n????????.##????#? 3,1,4,2\n????#???#????#? 4,2,2\n?...??.?.??...?? 1,2\n?#???#.??# 1,1,1\n??.#?#??#??? 1,1,2,4\n????.???..#???.????? 1,1\n.???.?.#?????##???. 2,1,8\n???????.#?#?.???#? 5,1,4,4\n?.#.?##..?????.. 1,2,2\n..??????#.??.??? 6,2\n??????.?#??.?#??? 1,1,1,2,4\n.??.???#?..#?##.#??? 1,1,2,4,4\n???.#???????#???#??? 1,15\n.#??.??.?#? 1,1,1\n?????.?.#?#? 1,1,1,1\n?#???????#??#??? 4,3,5\n?####?###??? 4,3,1\n.##?##??##.?.??? 9,1\n?#?.??#??.. 2,4\n..????.??. 1,1,1\n#..??#.???????. 1,1,1,1,1\n?????.#???##?#?# 1,1,1,8\n??.?.????#? 2,1,1\n???#??..?#??????#??? 3,1,2,9\n??.?????##??.#???#?# 1,1,5,7\n?????.?##? 3,2\n?#?.?##.????????#.?# 3,2,1,3,1,1\n?######?????#??#. 8,1,1\n?.??#??????#??? 7,2,1\n???????.?#?#.???.? 2,1,1,4,1,1\n??.#?##??.?.??#? 1,6,1,3\n???#???.???. 5,1\n??????.??. 4,2\n???#??#?????##???. 14,2\n.???#?.??.?# 2,1,1,1\n??????.??#??.???? 6,4,3\n?#??#?????#??##????. 15,1\n#?#??????##????.?? 7,4,1,1\n.??#???#?????.#? 1,1,5,1,2\n?.#?.??###?#??##??? 1,1,14\n?????????##?#?????# 3,1,3,1,2,1\n?#?##.?.?? 5,2\n.?????.?.#?#??#? 2,1,1,1,5\n#??#????.????? 1,1,2,1\n??????#?##?#??.? 1,1,8,1\n?###?#..?.#??? 5,2\n##????.??#??##??# 2,1,1,1,5\n.#??##??.?#??.?#???? 1,4,2,1,4\n#??#???.?.?#??#.#? 4,2,1,5,1\n.????..??.#????.? 1,5\n.?.?????#? 1,1,2\n#??#.?#??????? 1,2,8\n#???#####?#??? 1,11\n?.#??????? 3,1\n??.?##???#??.??#?.? 1,3,2,1,1,1\n?.?.??##?.?#?#???? 1,4,8\n???#?#??.##????#?? 3,1,1,4,3\n??##???#.. 5,1\n?.#???#??.?? 2,4\n.???.#..?#???.?? 2,1,4,1\n.?.???#?????? 1,1,5,1\n???##?###???#??# 9,5\n??#?..?.#??? 2,1,1,1\n?##???????? 2,3\n?#?.?#?#.#?.?.? 1,4,2,1\n??????????.??? 2,4,3\n?#????#??#.?#.?..? 7,1,2,1,1\n?#?.?#.???.??#??.?. 2,1,1,3,1,1\n???.##??#?????..# 3,9,1\n?#?#????????? 5,2,3\n.??##????.?#???#?? 5,1,3,2\n???.#.?#..#???? 3,1,1,2,1\n????????##?. 2,5\n?#.?#??##?. 1,6\n???.#???#?#?#?? 2,5,5\n..#..#??????#?#? 1,6,3\n??#?#??????.#??#? 5,1,4\n?#??.?????.??????# 2,1,4,7\n.???.?????????#????? 3,2,1,2,2,1\n??.????.?#.?? 1,1,1,1\n????.????#?. 3,4\n?????#..?????#?????# 1,1,6,1,1,1\n..??????.?? 1,3\n?#.#?.?#?##???##???? 2,1,6,3,3\n?##???..?.?.??.#??#? 6,1,2,1,1\n????#.#?##????#?? 1,1,1,6,1\n.????.??##??#??.???# 1,1,9,1,1\n???#??#??.????#.??? 5,1,1,2,2,1\n????##??#??###?#.??? 6,1,6,1\n.????????? 3,2\n#??#.??#???#?#?# 4,1,1,6\n..#?...??#?##? 2,6\n?.#??#??#???##??# 9,5\n..#.????????? 1,3\n???.????????.? 2,5,2,1\n?#.??.??????? 1,1,7\n?#???#?#?.. 1,5\n.??#?.??.?.???.#?.? 3,2,1,1,2,1\n?????.???????#?##. 1,2,1,1,2,4\n???#??#??#?. 6,2\n?####.??.#?? 5,1,1\n.??#?#????# 1,8\n???.##???..??#???? 4,2\n???#???????#?. 1,1,6\n????.??????? 1,4\n???....#???. 1,3\n.?.?????##?.??.?. 1,1,4,1,1\n##????.??.#??????? 3,1,1,2,1,3\n??#???#?.#.?????#?. 1,6,1,6\n????##?##?.??????? 1,3,2,4,1\n??.???#??.?????.? 1,4,3,1\n???.?#.???? 1,1,2\n?#?###?#????????.?? 16,1\n??#.???.???.??? 1,2,1,1,1\n.??..#?#?# 1,5\n????.???????#? 4,8\n???###???##?????#?? 1,10,3\n???#??.??#.?. 3,3\n????###?#?#?..??? 5,3,2\n?????##?#?#????#??## 3,7,1,1,2\n?..#?#?.?#.? 1,3,2,1\n????#..????.. 2,3\n??#.???#?#??#????.? 3,3,8\n???#?.??????? 1,2,1,1\n?????#?????#??##?? 1,1,2,1,8\n#?????.??.?????.? 1,1,1,4,1\n????.??????.? 1,3,1\n????????????#? 7,2\n????..??#?? 1,4\n?#???????#?#???#.? 4,3,2\n?.#??..???? 1,1\n.??###????.??? 7,1\n?#???????#???#?? 1,2,3,1,1\n..???????????????#? 2,2,6,1\n.##?????????..??#?? 9,5\n???????..?? 1,1\n????#?????.?#?#? 1,6,1,4\n??.?#?..???? 1,1,1,1\n?????#????#???####?? 1,2,9\n#??#???#?#??.????? 1,9,2,1\n.???.????????. 1,4,1\n??.??#??.##?.???? 1,3,1,2,1\n.?##??.?????#? 4,2,1\n..???#????????#?. 1,3,1,3\n#???#?#?.?#?#.#??# 8,3,1,1\n?#?????.???? 3,1,2,1\n#..?.?.#???? 1,1,1,1\n#?#.#?#??#.?. 3,1,4,1\n?#???.???#?? 4,1,1,1\n.?#?#?#..?##?????? 1,1,1,3,1,1\n?###?#??????? 3,3,2\n#???#???.?.??# 1,4,1,3\n????#?#?#?..??.?#? 6,2\n.????#?#?#?.??? 9,1\n.#?#??#?#????### 8,4\n????.?##?#?? 3,6\n???#?###?#?##????.? 4,8,1\n????#?????##???.???. 1,4,7,2\n??.?#????#?.??#?##? 1,2,3,1,1,3\n??????????#?#?? 3,6,2\n????#?????.????????# 9,1,1,1,1,1\n?#???#????.##???? 1,4,2,2,1\n.????#?..##?#??.? 1,4,5,1\n??####??#??.?#.???? 5,3,2,1,1\n??.???#?.?? 2,2,2\n??????##???? 3,3\n.?#?.?#?#??# 1,7\n?##?#?##???#?????? 5,11\n?#?.???.??.?????.?#. 2,1,1,5,2\n.???.???..#.. 2,1,1,1\n????##?##?.#?#???? 2,5,1,3,1\n??..#?##?#?? 2,6,1\n???#???.#??? 1,1,1,4\n?.?#?????##????#.? 3,1,3,3\n??#?.????#??#???#?#. 3,1,11\n?????.??#? 2,2,3\n???#?#?..?????. 4,4\n???.??.?.#??.? 2,2\n??.#???.??????? 4,2\n?.???#?#?#?#??.?..? 1,12,1,1\n?#.??????#.##????# 1,6,2,1,1\n??#????.#???????.. 1,2,1,3,1,1\n.#?.#??#???????.??? 1,2,2,3,1,1\n????.#???????#??.??? 1,1,1,4,1,2\n????.?????? 2,1\n#???#????.?. 5,1\n???#?????.?.??##??? 1,6,5\n??.??#??????#?????.# 1,6,2,1,1,1\n#???###????.?? 7,1,1,1\n.????.?#..? 4,1\n.?.????#??????# 8,1\n?.#????#?##??? 1,10\n?.??#?.???? 3,2\n.##..#?#.??..???.? 2,3,1,1\n?????..#?? 4,1,1\n?????????????#. 1,1,9\n#?##??.??#.?? 6,1,1,1\n...???.??#. 1,1,1\n??#?#?.?.?.#?? 6,2\n.???.????????? 1,1,1,3\n???##?.??#???# 3,1,5\n##???#????????. 2,10\n#????????.#?..??#.?? 3,5,2,3\n.###??.?????. 4,1,1\n..????###?#??#???? 2,9\n????#???#..#?.??#? 3,3,2,1,1\n.????#..?##?????? 5,4,1,1\n??#?????????.?# 7,1,1,2\n#?#?#??????##??# 7,6\n#??.????##. 3,4\n###?##.?##???.?????? 6,4,2\n#?????#?.??# 1,3,1,3\n#?#?##??#????#???.? 1,9,1,1,1\n##???#?##?.???#. 2,6,1,1\n?????#?#?.?# 1,4,2\n.?????????? 1,6,1\n?#?????????#? 1,6\n.???????#??#.?.?? 3,1,1,2,1\n?.#.??????# 1,3,1\n###???.????????.???? 5,2,1,1,1,1\n.##.?.?#????.?.? 2,6,1\n?????##???##.???#? 1,6,2,4\n?#??#?.??#? 3,1,3\n.????.#.?.# 2,1,1\n??????#?##????.? 1,9\n????..??#??##??? 2,10\n###?????.???? 7,1,1\n###?#??????#.? 5,5\n?.##??##?. 3,2\n?.#.?.?#????#?.?? 1,3,3\n#???#??#.?? 3,1,1\n..??.???????.?. 1,4,1\n??##?#????.?????. 8,2\n??#??????.. 3,2\n????##??#??...??. 8,1,2\n#.?????###????? 1,1,1,3,1\n#.????#.#.???????##? 1,1,3,1,1,7\n##?#???#??..??? 4,4,1\n.????#?#???#????? 5,6\n#??#?????.?? 1,2,2,1\n???##???.?..? 4,1\n.#????????#??.? 1,1,3,1,1\n????.???????.##??? 1,2,3,5\n???..?##??????? 2,8\n?#?#?##?.?.???#. 8,1,1,1\n?????.#?#??#??????? 1,1,12\n????.#???#??#? 3,3,1,2\n?.?#?.#?#????#..? 1,2,6,1,1\n###?.??#.#????? 4,1,1,2,1\n?.???##??####??#?? 4,8\n???#####?# 7,1\n?##??#?..?#???? 6,1,3\n???????#??.?#????##? 1,2,3,3,2\n??????#?????##?# 1,6,4\n.?.?#..????? 1,1,3\n.?#?????##?? 2,8\n????#.?.????##?? 1,1,1,1,5\n?????.#??.. 1,2\n##??..???###??#.? 4,5,1\n???.?#??#?.#?? 3,1,2,3\n.??#?#??#??? 2,7\n?#???.??#?.??? 5,1,1,1\n...????##?.???????. 2,4,3\n??????????.??? 1,1,3,1\n.???#??#??? 7,2\n.#?#?...?.. 4,1\n??.??..?#????? 1,4\n?###?###??#?????? 8,2,2,1\n??.?????#??.?#. 1,1,4,2\n?#?.???#??..?? 2,5,1\n????.????.???# 4,1,2,3\n???.#..?.# 1,1,1\n?#..#?#?#????.??? 1,8,3\n.???...#???#????#??? 1,5,5\n???##?##???#??.? 1,10,1\n#??????#????? 1,6\n.??????###??????# 12,1\n??????..?? 1,1,1\n????..#?.??????????? 1,1,1,5,4\n?#?????#??.?.. 9,1\n???##???..?. 5,1\n#.?#?.#.????.???# 1,3,1,2,4\n.??#?.?#??#??. 1,2,2\n?#????#?.??#?????? 3,1,1,1,1,1",
		"???.### 1,1,3\n.??..??...?##. 1,1,3\n?#?#?#?#?#?#?#? 1,3,1,6\n????.#...#... 4,1,1\n????.######..#####. 1,6,5\n?###???????? 3,2,1",
	}
	var res []int
	for _, input := range inputs {
		res = append(res, d12(input, 1))
		res = append(res, d12(input, 5))
	}
	return res
}

func d12(input string, copies int) int {
	lines := strings.Split(input, "\n")
	res := 0
	for _, line := range lines {
		qwe := strings.Split(line, " ")
		pattern := qwe[0]
		numsRaw := qwe[1]
		numsArr := strings.Split(numsRaw, ",")
		nums := make([]int, len(numsArr))
		for i, v := range numsArr {
			nums[i], _ = strconv.Atoi(v)
		}
		m = make(map[int]map[int]map[bool]int)
		res += f_(pattern, nums, copies)
	}
	return res
}

func f_(pattern string, nums []int, copies int) int {
	p := pattern
	for i := 1; i < copies; i++ {
		p += "?" + pattern
	}
	nums2 := make([]int, 0, len(nums)*copies)
	for i := 0; i < copies; i++ {
		for _, n := range nums {
			nums2 = append(nums2, n)
		}
	}
	return f(p, nums2, false)
}

func s(nums []int) int {
	res := 0
	for _, n := range nums {
		res += n
	}

	return res
}

func f(pattern string, nums []int, col bool) int {
	if _, ok := m[len(pattern)]; !ok {
		m[len(pattern)] = make(map[int]map[bool]int)
	}
	t := s(nums)
	if len(pattern) < t+len(nums)-3 {
		return 0
	}
	if _, ok := m[len(pattern)][t]; !ok {
		m[len(pattern)][t] = make(map[bool]int)
	}
	if res, ok := m[len(pattern)][t][col]; ok {
		return res
	}
	if len(pattern) == 0 {
		if t > 0 {
			m[len(pattern)][t][col] = 0
			return 0
		}
		m[len(pattern)][t][col] = 1
		return 1
	}
	if pattern[0] == '.' {
		if col {
			if nums[0] == 0 {
				if len(nums) > 0 {
					nums = nums[1:]
				}
			} else {
				return 0
			}
		}
		m[len(pattern)][t][col] = f(pattern[1:], nums, false)
		return m[len(pattern)][t][col]
	}

	if pattern[0] == '#' {
		if col && nums[0] == 0 {
			m[len(pattern)][t][col] = 0
			return 0
		}
		if t == 0 {
			m[len(pattern)][t][col] = 0
			return 0
		}
		nums[0]--
		m[len(pattern)][t][col] = f(pattern[1:], nums, true)
		return m[len(pattern)][t][col]
	}

	if pattern[0] == '?' {
		if col {
			if nums[0] == 0 {
				if len(nums) > 0 {
					nums = nums[1:]
				}
				m[len(pattern)][t][col] = f(pattern[1:], nums, false)
				return m[len(pattern)][t][col]
			} else {
				nums[0]--
				m[len(pattern)][t][col] = f(pattern[1:], nums, true)
				return m[len(pattern)][t][col]
			}
		} else {
			if len(nums) == 0 {
				m[len(pattern)][t][col] = f(pattern[1:], nums, false)
				return m[len(pattern)][t][col]
			}
			if nums[0] == 0 {
				if len(nums) > 0 {
					nums = nums[1:]
				}
				m[len(pattern)][t][col] = f(pattern, nums, false)
				return m[len(pattern)][t][col]
			}
			nums2 := make([]int, len(nums))
			for i, n := range nums {
				nums2[i] = n
			}
			nums2[0]--
			m[len(pattern)][t][col] = f(pattern[1:], nums, false) +
				f(pattern[1:], nums2, true)
			return m[len(pattern)][t][col]
		}
	}

	return -1
}
