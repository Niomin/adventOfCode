package main

import (
	"strings"
)

func D16() []int {
	inputs := []string{
		".|...\\....\n|.-.\\.....\n.....|-...\n........|.\n..........\n.........\\\n..../.\\\\..\n.-.-/..|..\n.|....-|.\\\n..//.|....",
		"\\.............\\................\\....\\..../....\\/...............................\\...-..........-.\\.-....../....\n|\\......../|....\\..............-\\............./...........................-..........-......\\........\\........\n.......||......../....-./.../-...|.|..-......-.|....../................\\............|...................-..|..\n........./......-.............-\\......................|.\\./.......|........./......-......../..-.........|....\n....../....................-............................................../...../...|.........................\n....................\\....|/............................./.......-....|......../..........................\\....\n.|....../|.........-......|.............\\..|..................|......../.................|.|............-.|...\n.....-............\\\\............\\................/......-.........\\................\\..|../....................\n............|..|.......|......../................\\.......................|../....../......./.....|............\n.\\...........\\..\\.............../.........-/....|......................./.....-./-.........../-........-......\n|................\\.\\-.............../..-............./........./.................\\.............|...-.....-....\n.........-....|..|......................................\\.||...-../..|............../...../.../.........-.....\n.....-....-\\.................|...........|../.....\\...............................|...../../|.................\n.\\......\\......................\\....../.../.....-.../.........................../..|...........|..\\...........\n-............|.........-.-........-.........................|...\\...-...........\\.|...-....../..........|.....\n.........-.......|......\\.....\\..-...../..../.....\\.../............/..........-......./....../...........\\.../\n..............\\........................|.............................-../......-..-...../..................\\..\n.....\\......-.......-.......-......../../../........\\.......-..........|......./........................../...\n.\\...\\...................|./\\|.-..\\...............................\\..\\.....-....|......................./.....\n.................-...|....|.../...../.|.||.....-.|............................-..............\\................\n........................................../.......................|........\\......../.../..............|.....\\\n.......\\......./............................./........../../..........................-\\..................|...\n...........-...|..\\..........-.........\\.................././................|./.......|............../.......\n......./..................................\\...-.........\\........\\....../............................\\......\\-\n-.|..-|...............|..........................\\..........|.-.........\\............-.|.............\\.....|..\n.............................../..............-.....-.......-........................|.......-................\n.........\\.........-.........|...../......../......./....-...\\...................\\........\\...................\n..........\\.........\\........../...|.................|./...\\.......\\..........-...............................\n./...................|........../\\......../....................|..-...........\\...\\...........|..............|\n.....|...........\\-.\\.......-..........................-....-...................|....|.|...............-......\n.|.././......................|.......|.......|..............\\...../.................../.\\...-.................\n...........-........./....|.................|..-.....-............./...................................-..../.\n...................\\/..|.....-............../-......-..........|........................./...\\....-|....|-....\n........................./..-..|.\\-...............-......-/...../.......\\..|................-...\\.|.....\\.....\n\\...../.........................../....................-..........|........../..-..-.......\\........../.././|.\n........................../...\\|..................................................../...|.-........-.....|..\\.\n....\\.............................|./.....|...../....\\.............\\...../.......-...............\\..-..../....\n.........-.........................|................|........\\/.\\-...................\\..-......./../..........\n...-.../............/.................-..........\\....../............../...../..........|.....................\n..........\\...\\..................|...-......\\\\......./...-.............-\\.................|...../......\\......\n/..\\/.............\\....\\.............\\.......................................|.....\\....-............\\........\n....../..\\.|................................\\.........../.......-.......-/.....|...................-.....-....\n........-....|.............................|....../...............\\.......................--..................\n................/......|.........-....................-..............|.......................................|\n.........\\........|...........................\\.............|.............................../.................\n...|..\\....-......../.\\...-............................................................/....-...../...........\n.............\\\\\\.../...../.../..........\\..............\\...........\\........................|....../.........\\\n......-..............|..-..|....-\\..\\..-...-............\\.................\\...-.\\/.....\\......-.\\....--.../...\n........./...................../...../..|...\\.\\/.........\\.../........................................\\.../-..\n........\\.......|.......|\\..|........../..../\\........../........\\..../..............././..../.............-.\\\n........................|-............|............................./.-.|...|............../....-\\............\n../........-.../....................|....................-/.............../.....-...........-....\\......||....\n.....\\..|.....-|../....|./....-|.......-...../..-..\\..............\\...................../.................|...\n...-......../.\\...........\\.........\\../.....|............\\..................../.........\\................/.\\/\n...../...|............-..\\.../............/............-..............--.-..........././............-........|\n.....|...........\\.....-...\\..../.....-........-.....\\.|..............\\....-............./...../..............\n....\\.....-.|....\\..../..............\\|../.........../......|....\\/.......................|............|....-.\n........|..--..............|..............-........|.......|.-.........\\.............-...........\\............\n./.||....\\......./....\\./........../...........././....\\.................../..................\\...../.........\n.......|..\\...-.\\..\\..|.........../..................................-....|........\\......|....|..............\n...|..........|.........-...............|...............................-.......|...........-..\\.......\\......\n.\\.........../../............................-..|...\\.....-.........../......-|.../.....|.................-...\n........|....../..\\..\\|..|......|.........|...............................\\../.....\\....-/........-...........\n.................................................\\.......|........|.\\.-....../.......|.......|............\\...\n.......|.......\\.......|.........|......-......|...|...\\.............\\.............|/.........................\n..........|....................|..........\\..........-......./................................................\n...../.......|....................|......................././.................................................\n........\\.............|........--..........\\.............../......|...................../............|..\\.....\n....-............|.........|....|.-.\\../-...\\....-...-................\\|..\\-.......|........-............../..\n................/........\\.....\\.....././....|....................-...............\\...........-......\\........\n.\\.....|......|...|\\......\\.\\/....\\.............-............\\.....\\.......-...-........-....//..../.....|..-.\n..................|..|.-.................../\\...........|..../..........\\|.....-..|.../.......................\n-......-......./........./../.............../..................-..\\.......\\............|...../../....../......\n....../............/...........\\.............\\............./.........../.......\\......|....|.........../......\n...\\........|..................|............-............-.....-..\\..-................/........../........||..\n......../..|..-../..../......................../.........\\./.-................../...................-.........\n.../....|....\\.......-..\\..........-....\\.............|\\........../...............-........|..................\n..............\\.............\\|.........-......................-........\\|......./.......-.................|...\n/..../...-||\\-...|\\...............................\\.......................\\.............-................-....\n.......-..-....|..................|..............................................................///...-.../.|\n......|.......-/........-.-......|....\\..-...|...........\\...........\\.....................-..../.........../.\n......-...........|-..\\.......|...|.\\|.................-....\\...................\\.\\........\\.\\./.........\\....\n....../............../.........|...|.......|..../.............................................................\n.........../...................-./...\\..........\\-............./...........\\.../.....|......................-.\n/..../..../........................................|.\\......-/......./....\\.........................-......|..\n.\\./.|.-..........................|...|...........|....../....-....../|...............\\..............\\...-....\n....|...\\..........|......-..................|........../..|.-...\\........./........|................|........\n...\\....\\........../........../.........\\..............-...........................-.|...../..........\\.......\n...|...........-...........................\\........-.........................\\...-..-.....\\.......|........-.\n......\\|...........................\\.....................................-............/....\\...........|......\n................../............-........................\\.................................................-...\n.../....|...............|....................../\\.........|....................\\....|............\\.........|-.\n.......................................|....-.........../....\\-........|......./............-..|.............\\\n/.........\\..\\.........|...............\\.......\\........./................\\....................|.....|........\n..................................|.....|.-..|.../......................../-\\......|..........................\n.................|.....................................................-............|.....|..../.\\/..........|\n.......\\....\\....-........|.|..../......-......\\...../....................-...........\\............-..........\n....-.................................-..........-......-................................../.........-\\...|...\n.....................|......................|.........-............../.../.....-........\\.....................\n.\\./..........-.\\...\\||................./../........\\.........|...\\........\\....\\.\\...............-|......|...\n..\\......//.........../.\\........\\......|......|........\\......\\.....-..........|.-..|...../|.................\n/.....................\\.................-........|...................\\.....-..............-/.....\\..|../../...\n...|..-.../............./.|.................../............/..\\...........-....|-............\\.......--.......\n..............\\..\\/.....\\.........|.\\.........................|............|........./................./-..|-.\n...........................-.................../...................|\\..........\\/..|.-........................\n.....-.............................../....................\\.........|......................|..................\n..................\\.........../...........\\..\\/.........|...........|..-........|....\\..........-...../.|.....\n..........|.......\\..\\...........\\.../......................-...........-.....-........../\\|..................\n....../.......-........................\\|...//...\\..-......\\.......|..\\....................-..........\\..-....\n|./....|........-./........../.\\...\\.....|../..../.......-........../.\\.....-.................................",
	}
	var res []int
	for _, input := range inputs {
		data := strings.Split(input, "\n")
		res = append(res, d16p1(data, 0, 0, 1, 0))
		res = append(res, d16p2(data))
	}

	return res
}

func d16p2(data []string) int {
	res := 0

	for i := range data[0] {
		res = max(res, d16p1(data, i, 0, 1, 0))
		res = max(res, d16p1(data, i, 0, -1, 0))
		res = max(res, d16p1(data, i, 0, 0, 1))
		res = max(res, d16p1(data, i, 0, 0, -1))
		res = max(res, d16p1(data, i, len(data)-1, 1, 0))
		res = max(res, d16p1(data, i, len(data)-1, -1, 0))
		res = max(res, d16p1(data, i, len(data)-1, 0, 1))
		res = max(res, d16p1(data, i, len(data)-1, 0, -1))
	}

	for i := range data {
		res = max(res, d16p1(data, 0, i, 1, 0))
		res = max(res, d16p1(data, 0, i, -1, 0))
		res = max(res, d16p1(data, 0, i, 0, 1))
		res = max(res, d16p1(data, 0, i, 0, -1))
		res = max(res, d16p1(data, len(data[0])-1, i, 1, 0))
		res = max(res, d16p1(data, len(data[0])-1, i, -1, 0))
		res = max(res, d16p1(data, len(data[0])-1, i, 0, 1))
		res = max(res, d16p1(data, len(data[0])-1, i, 0, -1))
	}

	return res
}

func d16p1(data []string, x, y, dx, dy int) int {
	visited := make(map[[4]int]bool)
	c := make(map[[2]int]bool)
	nodes := make([][4]int, 1, 10000)
	nodes[0] = [4]int{x, y, dx, dy}
	c[[2]int{x, y}] = true
	visited[nodes[0]] = true

	for len(nodes) > 0 {
		l := len(nodes)
		for i := 0; i < l; i++ {
			x, y, dx, dy := nodes[i][0], nodes[i][1], nodes[i][2], nodes[i][3]
			x, y = x+dx, y+dy

			if x < 0 || y < 0 || x >= len(data[0]) || y >= len(data) {
				continue
			}
			c[[2]int{x, y}] = true
			els := make([][4]int, 0)
			if data[y][x] == '|' || data[y][x] == '-' {
				if data[y][x] == '|' {
					if dx == 0 {
						els = append(els, [4]int{x, y, dx, dy})
					} else {
						els = append(els, [4]int{x, y, 0, 1})
						els = append(els, [4]int{x, y, 0, -1})
					}
				} else {
					if dy == 0 {
						els = append(els, [4]int{x, y, dx, dy})
					} else {
						els = append(els, [4]int{x, y, 1, 0})
						els = append(els, [4]int{x, y, -1, 0})
					}
				}
			} else {
				if data[y][x] == '/' {
					dx, dy = -dy, -dx
				} else if data[y][x] == '\\' {
					dx, dy = dy, dx
				}
				els = append(els, [4]int{x, y, dx, dy})
			}

			for i := range els {
				point := els[i]
				if _, ok := visited[point]; !ok {
					visited[point] = true
					nodes = append(nodes, point)
				}
			}
		}
		nodes = nodes[l:]
	}

	return len(c)
}
